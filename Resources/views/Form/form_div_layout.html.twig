{% block form_group %}
    {% spaceless %}
    <fieldset id="{{ group }}">
        <legend>{{ group_name|trans({}, translation_domain) }}</legend>
        {% for element_name in elements %}
            {% if form[element_name] is defined %}
                {{ form_row(form[element_name]) }}
            {% endif %}
        {% endfor %}
    </fieldset>
    {% endspaceless %}
{% endblock %}

{% block form_rows %}
    {% spaceless %}
        {% for child in form %}
            {% if child.vars.group is null %}
            {{ form_row(child) }}
            {% endif %}
        {% endfor %}
    {% endspaceless %}
    {% spaceless %}
        {% for group, group_elements in form.vars.groups %}
            {{ form_group(form, {'group': group, 'group_name': form.vars.groups_names[group] , 'elements' : group_elements}) }}
        {% endfor %}
    {% endspaceless %}
{% endblock form_rows %}

{% block ckeditor_widget %}
{% spaceless %}
{% if form.vars.ckeditor_config.contentsCss is defined %}
{% set ckeditor_config = form.vars.ckeditor_config|merge({'contentsCss' : asset(form.vars.ckeditor_config.contentsCss)}) %}
{% else %}
{% set ckeditor_config = form.vars.ckeditor_config %}
{% endif %}
<textarea {{ block('widget_attributes') }} data-ckeditor-options="{{ ckeditor_config|json_encode }}">{{ value }}</textarea>
{{ include_ckeditor() }}
{% endspaceless %}
<script type="text/javascript">
{{ ckeditor_initializer() }}
initializeCkeditor();
</script>
{% endblock %}

{% block ckeditor_initializer %}
var initializeCkeditor = function() {
    var textareas = document.getElementsByTagName('textarea'),
            textarea = null,
            options = null,
            i = 0;

    for (i; i < textareas.length; i++) {
        textarea = textareas[i];
        if (textarea.hasAttribute('data-ckeditor-options')) {
            options = textarea.getAttribute('data-ckeditor-options');
            options = JSON && JSON.parse(options) || eval(options);
            CKEDITOR.replace(textarea.id, options);
            textarea.removeAttribute('data-ckeditor-options');
        }
    }
}
{% endblock %}